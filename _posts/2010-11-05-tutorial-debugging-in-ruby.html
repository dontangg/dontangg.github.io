---
layout: post
status: publish
published: true
title: 'Tutorial: Debugging in Ruby'
author:
  display_name: dontangg
  login: dontangg
  email: robert.don.wilson@gmail.com
  url: ''
author_login: dontangg
author_email: robert.don.wilson@gmail.com
excerpt: "Debugging is extremely useful to find problems in code. I'm going to give
  a really brief tutorial on how to use Ruby's built-in debugger for the most common
  debugging reasons. When I debug, these constitute 95% of what I ever want to do
  when I'm debugging. In simple terms, here's what I like to do when debugging:\n<ul>\n\t<li>Pause
  the code in the middle of execution (breakpoint)<&#47;li>\n\t<li>View the contents
  of variables (locals, watch, etc.)<&#47;li>\n\t<li>Run one line of code at a time
  (step over, step into, etc.)<&#47;li>\n\t<li>Run my own code while the program is
  paused<&#47;li>\n<&#47;ul>\n"
wordpress_id: 114
wordpress_url: http://don.thewilsonpad.com/?p=114
date: '2010-11-05 20:15:20 -0600'
date_gmt: '2010-11-06 02:15:20 -0600'
categories:
- Programming
tags:
- Ruby
comments:
- id: 562
  author: Someone
  author_email: someone@somewhere.com
  author_url: ''
  date: '2013-06-13 21:14:55 -0600'
  date_gmt: '2013-06-14 03:14:55 -0600'
  content: Thank you! Very useful since pry and debugger is not running for me on
    ruby 2.0!!!!
---
<p>Debugging is extremely useful to find problems in code. I'm going to give a really brief tutorial on how to use Ruby's built-in debugger for the most common debugging reasons. When I debug, these constitute 95% of what I ever want to do when I'm debugging. In simple terms, here's what I like to do when debugging:</p>
<ul>
<li>Pause the code in the middle of execution (breakpoint)<&#47;li>
<li>View the contents of variables (locals, watch, etc.)<&#47;li>
<li>Run one line of code at a time (step over, step into, etc.)<&#47;li>
<li>Run my own code while the program is paused<&#47;li><br />
<&#47;ul><br />
<a id="more"></a><a id="more-114"></a>Just to be clear, this is not a tutorial on how to use the gem ruby-debug. This is also not a tutorial on how to use irb. There are a lot of great tools and methods out there for debugging, but this is just about how to use the built-in ruby debugger. I am also only going to talk about the basics of debugging in Ruby. The built-in debugger, does much more than what I will show you. Learn more here: <a href="http:&#47;&#47;www.ruby-doc.org&#47;docs&#47;ProgrammingRuby&#47;html&#47;trouble.html">http:&#47;&#47;www.ruby-doc.org&#47;docs&#47;ProgrammingRuby&#47;html&#47;trouble.html<&#47;a>.</p>
<p>Here is the code I'm going to be working with:</p>
<p>[ruby]<br />
# lottery_numbers.rb<br />
def next_lottery_number(last_number)<br />
  case last_number<br />
  when nil<br />
    4<br />
  when 4<br />
    8<br />
  when 8<br />
    15<br />
  when 15<br />
    16<br />
  when 16<br />
    23<br />
  when 23<br />
    42<br />
  else<br />
    nil<br />
  end<br />
end</p>
<p>current_number = 1<br />
while current_number<br />
  current_number = next_lottery_number(current_number)<br />
  puts current_number<br />
end<br />
[&#47;ruby]</p>
<p>Basically, all that it should do is output the lottery ticket numbers that would make you win the lottery (4, 8, 15, 16, 23, 42). When I run the program nothing outputs. It doesn't work and I can't figure out why. So, we'll debug it.</p>
<p>To start the debugger, we just type:</p>
<p>[bash light="true"]<br />
ruby -r debug lottery_numbers.rb<br />
[&#47;bash]</p>
<p>The -r option tells Ruby to require a library before it runs my program and I specified to require the debug library.</p>
<p>When I run that, it responds with this:</p>
<p>[sourcecode language="bash" light="true"]<br />
Debug.rb<br />
Emacs support available.</p>
<p>lottery_numbers.rb:2:def next_lottery_number(last_number)<br />
(rdb:1)<br />
[&#47;sourcecode]</p>
<p>It shows the line that it is about to execute. Of course, it skipped the first line because it was a comment and we are now looking at line 2. Just to feel safe that we are where we think we are, lets run 'list' to see for sure.  (Also, the commands I type all start with (rdb:#).  Everything else is output by the debugger.)</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) list<br />
[-3, 6] in lottery_numbers.rb<br />
   1  # 4 8 15 16 23 42<br />
=> 2  def next_lottery_number(last_number)<br />
   3    case last_number<br />
   4    when nil<br />
   5      4<br />
   6    when 4<br />
[&#47;sourcecode]</p>
<p>Yep, that's where we are! Ok we're not too interested in this line. This line is just going to define a method, let's go to the "next" line.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) next<br />
lottery_numbers.rb:21:current_number = 1<br />
[&#47;sourcecode]</p>
<p>It skipped the entire method definition because it doesn't execute anything inside the method until the method is called. So, now we are on the line that defines our variable. We are definitely interested in this. Let's tell it to keep us updated on the contents of that variable by running the "display" command.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) display current_number<br />
1: current_number =<br />
[&#47;sourcecode]</p>
<p>Currently, our variable doesn't have anything. That will change when we go to the next line ("n" is a shortcut for the next command).</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) n<br />
lottery_numbers.rb:22:while current_number<br />
1: current_number = 1<br />
[&#47;sourcecode]</p>
<p>Alright, now we can see that our current_number has the value of 1 in it. Everything is going the way we planned it. I'll keep going to the next line until I see something suspicious.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) n<br />
lottery_numbers.rb:23:  current_number = next_lottery_number(current_number)<br />
1: current_number = 1<br />
(rdb:1) n<br />
lottery_numbers.rb:24:  puts current_number<br />
1: current_number =<br />
[&#47;sourcecode]</p>
<p>Uh oh! For some reason, current_number was set back to nothing before anything was output. We also learned that the next (n) command steps over methods. It didn't take us into the next_lottery_number method. Let's quit the debugger, and debug again. This time we'll step into the method.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) q<br />
Really quit? (y&#47;n) y<br />
$ ruby -r debug lottery_numbers.rb<br />
Debug.rb<br />
Emacs support available.</p>
<p>lottery_numbers.rb:2:def next_lottery_number(last_number)<br />
(rdb:1) b 23<br />
Set breakpoint 1 at lottery_numbers.rb:23<br />
(rdb:1) c<br />
Breakpoint 1, toplevel at lottery_numbers.rb:23<br />
lottery_numbers.rb:23:  current_number = next_lottery_number(current_number)<br />
[&#47;sourcecode]</p>
<p>Notice that this time, I set a breakpoint on line 23 (b 23) then I told the program to continue (c) until it hit that breakpoint. Now, we're ready to step in with the step command ("s" is the shortcut).</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) s<br />
lottery_numbers.rb:3:  case last_number<br />
(rdb:1) l<br />
[-2, 7] in lottery_numbers.rb<br />
   1  # 4 8 15 16 23 42<br />
   2  def next_lottery_number(last_number)<br />
=> 3    case last_number<br />
   4    when nil<br />
   5      4<br />
   6    when 4<br />
   7      8<br />
[&#47;sourcecode]</p>
<p>Alright! We're in the method now. Now we can follow it to see what went wrong.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) disp last_number<br />
1: last_number = 1<br />
(rdb:1) s<br />
lottery_numbers.rb:24:  puts current_number<br />
1: last_number =<br />
[&#47;sourcecode]</p>
<p>Oh, I guess the way that I wrote it, we don't really get to see much by stepping into the method. Let's experiment. I'm going to quit the debugger, go back to line 23 and manually set current_number to 4 before it calls the method to get the next number.</p>
<p>[sourcecode language="bash" light="true"]<br />
(rdb:1) q<br />
Really quit? (y&#47;n) y<br />
dons-macbook:Sites don$ ruby -r debug lottery_numbers.rb<br />
Debug.rb<br />
Emacs support available.</p>
<p>lottery_numbers.rb:2:def next_lottery_number(last_number)<br />
(rdb:1) b 23<br />
Set breakpoint 1 at lottery_numbers.rb:23<br />
(rdb:1) c<br />
Breakpoint 1, toplevel at lottery_numbers.rb:23<br />
lottery_numbers.rb:23:  current_number = next_lottery_number(current_number)<br />
(rdb:1) current_number = 4<br />
4<br />
(rdb:1) disp current_number<br />
1: current_number = 4<br />
(rdb:1) l<br />
[18, 27] in lottery_numbers.rb<br />
   18    end<br />
   19  end<br />
   20<br />
   21  current_number = 1<br />
   22  while current_number<br />
=> 23    current_number = next_lottery_number(current_number)<br />
   24    puts current_number<br />
   25  end<br />
(rdb:1) n<br />
lottery_numbers.rb:24:  puts current_number<br />
1: current_number = 8<br />
[&#47;sourcecode]</p>
<p>To run my own line of code, all I had to do is type in the code that I wanted to run! That's pretty easy, right? And look! When I started out as 4, it correctly set the next number to 8. Well, as you probably noticed, I originally thought that I would pass nil into the function the first time through. That changed when I got to the bottom and I realized that I couldn't pass nil in if I wanted to use it in the while loop the way that I did. Then, I just forgot that it would affect the method that I wrote. Let's make a small change to line 4 to check for the number 1 instead of nil.</p>
<p>[sourcecode language="ruby" highlight="3"]<br />
def next_lottery_number(last_number)<br />
  case last_number<br />
  when 1<br />
    4<br />
[&#47;sourcecode]</p>
<p>[sourcecode language="bash" light="true"]<br />
$ ruby lottery_numbers.rb<br />
4<br />
8<br />
15<br />
16<br />
23<br />
42<br />
[&#47;sourcecode]</p>
<p>Awesome! When we run the program now, it works!</p>
<p>This was a pretty basic example and it doesn't show all the commands you can use with the built-in debugger. I hope it can be a quick helpful tutorial for people trying to debug their Ruby code.</p>
<p>This would actually be a fun way to debug:&nbsp;<a href="http:&#47;&#47;www.youtube.com&#47;watch?v=8_HSCMTo6xw">YouTube clip<&#47;a>.</p>
