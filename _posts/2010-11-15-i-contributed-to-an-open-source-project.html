---
layout: post
status: publish
published: true
title: I Contributed to An Open Source Project!
author:
  display_name: dontangg
  login: dontangg
  email: robert.don.wilson@gmail.com
  url: ''
author_login: dontangg
author_email: robert.don.wilson@gmail.com
excerpt: "<a href=\"http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;rails.png\"><img
  class=\"size-medium wp-image-187 alignright\" title=\"Ruby on Rails\" src=\"http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;rails-235x300.png\"
  alt=\"\" width=\"235\" height=\"300\" &#47;><&#47;a>In my last post, I talked about
  my envelopes budgeting project a little bit. Well, obviously, I need to display
  numbers as a currency. I found a convenient function in Rails where I could supply
  a number and it would format it nicely (eg. $50.12). However, I quickly noticed
  that negative numbers were formatted incorrectly (eg. $-50.12 instead of <span style=\"white-space:
  nowrap;\">-$50.12<&#47;span>). I did some searching on the internet and found others
  frustrated with that as well, so I just wrote my own function.\r\n\r\nI left it
  for a while, but then I decided to see if I could contribute my solution to the
  Ruby on Rails source code. It was a fun process. I had to learn how to use Git a
  little more. I had to learn more about the way Rails works. But, I was finally able
  to submit a patch that was accepted and will be incorporated in version 3.0.2 of
  Rails.\r\n\r\n<strong>Edit:<&#47;strong> It is now incorporated into Rails. You
  can see my change in the documentation <a href=\"http:&#47;&#47;api.rubyonrails.org&#47;classes&#47;ActionView&#47;Helpers&#47;NumberHelper.html\">here<&#47;a>.\r\n"
wordpress_id: 98
wordpress_url: http://don.thewilsonpad.com/?p=98
date: '2010-11-15 04:00:44 -0700'
date_gmt: '2010-11-15 11:00:44 -0700'
categories:
- Programming
tags:
- open-source
comments:
- id: 8
  author: Farook
  author_email: farook@farookkhan.com
  author_url: http://farookkhan.com
  date: '2010-11-15 16:31:21 -0700'
  date_gmt: '2010-11-15 23:31:21 -0700'
  content: Congratulations!
---
<p><a href="http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;rails.png"><img class="size-medium wp-image-187 alignright" title="Ruby on Rails" src="http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;rails-235x300.png" alt="" width="235" height="300" &#47;><&#47;a>In my last post, I talked about my envelopes budgeting project a little bit. Well, obviously, I need to display numbers as a currency. I found a convenient function in Rails where I could supply a number and it would format it nicely (eg. $50.12). However, I quickly noticed that negative numbers were formatted incorrectly (eg. $-50.12 instead of <span style="white-space: nowrap;">-$50.12<&#47;span>). I did some searching on the internet and found others frustrated with that as well, so I just wrote my own function.</p>
<p>I left it for a while, but then I decided to see if I could contribute my solution to the Ruby on Rails source code. It was a fun process. I had to learn how to use Git a little more. I had to learn more about the way Rails works. But, I was finally able to submit a patch that was accepted and will be incorporated in version 3.0.2 of Rails.</p>
<p><strong>Edit:<&#47;strong> It is now incorporated into Rails. You can see my change in the documentation <a href="http:&#47;&#47;api.rubyonrails.org&#47;classes&#47;ActionView&#47;Helpers&#47;NumberHelper.html">here<&#47;a>.<br />
<a id="more"></a><a id="more-98"></a></p>
<h1>An Overview of What I Did<&#47;h1><br />
Here are the basic steps that I took:</p>
<ol>
<li>Searched for existing tickets and conversations about the issue.<&#47;li>
<li>Researched and learned the way that the function was currently working.<&#47;li>
<li>Planned out a solution based on research of how it should work.<&#47;li>
<li>Cloned the Rails repository and made my changes.<&#47;li>
<li>Created a patch and attached it to a ticket to be reviewed by the Rails team.<&#47;li>
<li>Implemented feedback from the Rails ticket and submitted patches until it was accepted.<&#47;li><br />
<&#47;ol><br />
That is a lot of steps, but the actual process didn't take very long. I started researching it and thinking about it on Friday, October 29 and it was accepted into Rails on Tuesday, November 2. So, that's only 5 days and I wasn't doing it all the time.</p>
<h1>A Little More Detail<&#47;h1><br />
I thought I would describe in more detail what I did, so that you can do it too, if you want. First of all, I found out that different open source projects want you to contribute in different ways. Obviously, I'm going to describe the Rails way. They have an article (<a title="Contributing to Rails" href="http:&#47;&#47;guides.rubyonrails.org&#47;contributing_to_rails.html">http:&#47;&#47;guides.rubyonrails.org&#47;contributing_to_rails.html<&#47;a>) on how to contribute to Rails that I looked at quite a bit.</p>
<h2>Research Current Conditions<&#47;h2><br />
I did a lot of Google searches to see if others were seeing the same problem as me and if there was anyone that had already attempted to fix it. I did find a lot of people with their own little hacks to get it to work the way they wanted. I also found one person several years ago that submitted a patch to fix it, but it went stale and never got incorporated. It was a good way to learn what people wanted and to see suggestions on how it should work.</p>
<h2>Learn And Research Rails<&#47;h2><br />
All of the Rails code is open source (duh, that's why I can contribute). It's all hosted on <a title="Rails on GitHub" href="https:&#47;&#47;github.com&#47;rails&#47;rails">GitHub<&#47;a>. So, I went to the code and started getting familiar with how the number_to_currency function worked. I found the file I needed to change fairly easily by looking at the <a title="Documentation for number_to_currency" href="http:&#47;&#47;api.rubyonrails.org&#47;classes&#47;ActionView&#47;Helpers&#47;NumberHelper.html#method-i-number_to_currency">documentation for the function<&#47;a>. The path to the file was right there when I clicked view source. Finding the files where the tests were stored was a little more challenging, but not too hard.</p>
<h2>Researched Best Solution<&#47;h2><br />
I knew that this was not a simple issue to resolve. Well, it was a simple issue to resolve, but not a simple issue to decide what the best resolution would be especially because of how much it can vary by locale. So, I looked at other languages to see what they did to determine how to format negative currencies. I looked at all of the people that I found had issues with it and how they wished it would work and I decided what I thought would be the best way to do it.</p>
<h2>Fix It<&#47;h2><br />
Finally, it was time to get my hands dirty. I already had Git installed on my computer and I already had a GitHub account (it's free). I went to the Rails repository on Git and I clicked "Fork." This basically creates a copy of the repository under your name. I don't know if I would do it this way again, though. In other open source projects, you fork and then when you're done, you send a pull request. That's not how Rails does it. With Rails, you just make your changes and submit a patch. So, it's not necessary to create your own copy under your account.</p>
<p>Once, I had my forked copy, I cloned it onto my computer.</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git clone git:&#47;&#47;github.com&#47;dontangg&#47;rails.git<br />
[&#47;sourcecode]</p>
<p>As I'm sure you know, this basically puts a copy of the repository on my computer in a folder named rails. It also creates a link (called a remote in Git) to the origin on GitHub.</p>
<p>Since we need to make sure that what we have is always in sync with the actual rails repository, we have to add another remote.</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git remote add upstream https:&#47;&#47;github.com&#47;rails&#47;rails.git<br />
[&#47;sourcecode]</p>
<p>This creates another remote called upstream (call it what you want) to the main rails repository. Now, we can pull the source from the main repository to make sure we have the latest stuff (if we don't I'd be surprised).</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git pull upstream master<br />
[&#47;sourcecode]</p>
<p>This pulls the code from upstream into our master branch in our local repository. Now, we can create a branch for our fix. We'll call the branch currency-fix.</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git checkout -b currency-fix<br />
[&#47;sourcecode]</p>
<p>Now, I was ready to make my changes. Once the changes were made, I modified Rails tests to help prevent regression (breaking functionality later on). To run the tests, first I had to make sure that I had all the gems I needed. This is easy now with bundler. Make sure you have bundler.</p>
<p>[sourcecode language="bash" light="true"]<br />
$ gem install bundler<br />
[&#47;sourcecode]</p>
<p>Then, to install all the needed gems:</p>
<p>[sourcecode language="bash" light="true"]<br />
$ bundle install --without db<br />
[&#47;sourcecode]</p>
<p>Now, with all the prerequisites installed, I went to the actionpack&#47;test&#47; directory in rails and ran this command:</p>
<p>[sourcecode language="bash" light="true"]<br />
$ ruby -I . template&#47;number_helper_test.rb<br />
Loaded suite template&#47;number_helper_test<br />
Started<br />
....................<br />
Finished in 0.459888 seconds.</p>
<p>20 tests, 212 assertions, 0 failures, 0 errors, 0 skips<br />
[&#47;sourcecode]</p>
<p>Sweet, all the tests passed including the ones I added. We just need to make sure that we still have the latest rails stuff and then we're ready to go! Let's switch back to the master branch and get the code again. Then we'll have to switch back to our branch and "rebase" our branch on the master.</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git checkout master<br />
Switched to branch 'master'<br />
$ git pull upstream master<br />
...<br />
$ git checkout currency-fix<br />
Switched to branch 'currency-fix'<br />
$ git rebase master<br />
[&#47;sourcecode]</p>
<p>Rebase basically rewinds our changes back to where we branched from master originally. Then, it applies changes made to the master branch and then it applies our changes again. This way our branch has the latest stuff from the master branch (that it got from the Rails repository).</p>
<h2>Create A Patch And Create A Ticket<&#47;h2><br />
Creating a patch is pretty simple. Just run this:</p>
<p>[sourcecode language="bash" light="true"]<br />
$ git format-patch master --stdout > my_new_patch.diff<br />
[&#47;sourcecode]</p>
<p>That creates a patch in the directory that you run the command. The Rails community like you to create a ticket in Lighthouse and describe the issue and attach your patch. You can see the ticket I created <a title="My Lighthouse Ticket" href="https:&#47;&#47;rails.lighthouseapp.com&#47;projects&#47;8994&#47;tickets&#47;5894-number_to_currency-doesnt-format-negative-numbers-correctly">here<&#47;a>.</p>
<h2>Implement Feedback and Submit More Patches<&#47;h2><br />
I got some feedback and I had to make a couple more changes and resubmit patches a few times, but the process was always the same. I thought it was a lot of fun and kind of rewarding to see my changes actually get implemented into Rails. My name is now also on a list of 1,693 people that have contributed to Rails. That's a lot of people, but I'm one of them. It was a fun little project for me. I enjoyed it a lot.</p>
<p><a href="http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;Screen-shot-2010-11-03-at-11.41.38-PM.png"><img class="aligncenter size-full wp-image-159" title="I'm a Rails contributor!" src="http:&#47;&#47;blog.donwilson.net&#47;wp-content&#47;uploads&#47;2010&#47;11&#47;Screen-shot-2010-11-03-at-11.41.38-PM.png" alt="" width="824" height="582" &#47;><&#47;a></p>
